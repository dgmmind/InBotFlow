<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Flowchart Bot</title>
  <style>
    canvas {
      border: 1px solid #000;
    }
  </style>
</head>
<body>
  <h2>Diagrama de Flujo (Chatbot)</h2>
  <canvas id="flowchart" width="900" height="700"></canvas>

  <script>
    const nodes = [
      { id: "1", message: "¡Hola! ¿Qué quieres pedir?", connections: ["2", "3"], position: { x: 100, y: 100 } },
      { id: "2", message: "Tenemos sabores: Vainilla, Fresa, Chocolate", connections: ["4"], position: { x: 50, y: 250 } },
      { id: "3", message: "Tipos de café: Espresso, Latte, Cappuccino", connections: ["5"], position: { x: 250, y: 250 } },
      { id: "4", message: "¿Qué tamaño quieres para tu helado?", connections: ["6"], position: { x: 50, y: 400 } },
      { id: "5", message: "¿Qué tamaño quieres para tu café?", connections: ["7"], position: { x: 250, y: 400 } },
      { id: "6", message: "¿Extras para tu helado?", connections: ["8"], position: { x: 50, y: 550 } },
      { id: "7", message: "¿Extras para tu café?", connections: ["9"], position: { x: 250, y: 550 } },
      { id: "8", message: "Pedido helado final", connections: [], position: { x: 50, y: 700 } },
      { id: "9", message: "Pedido café final", connections: [], position: { x: 250, y: 700 } }
    ];

    const canvas = document.getElementById("flowchart");
    const ctx = canvas.getContext("2d");

    function drawNode(node) {
      const w = 220;
      const h = 60;
      ctx.fillStyle = "#fff";
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;

      // Dibujar rectángulo
      ctx.fillRect(node.position.x, node.position.y, w, h);
      ctx.strokeRect(node.position.x, node.position.y, w, h);

      // Texto centrado
      ctx.fillStyle = "#000";
      ctx.font = "14px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(node.message, node.position.x + w / 2, node.position.y + h / 2);
    }

    function drawArrow(x1, y1, x2, y2) {
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.stroke();

      // Flecha
      const headlen = 10;
      const angle = Math.atan2(y2 - y1, x2 - x1);
      ctx.lineTo(x2 - headlen * Math.cos(angle - Math.PI / 6),
                 y2 - headlen * Math.sin(angle - Math.PI / 6));
      ctx.moveTo(x2, y2);
      ctx.lineTo(x2 - headlen * Math.cos(angle + Math.PI / 6),
                 y2 - headlen * Math.sin(angle + Math.PI / 6));
      ctx.stroke();
    }

    function drawFlowchart() {
      // Dibujar conexiones primero
      nodes.forEach(node => {
        node.connections.forEach(connId => {
          const target = nodes.find(n => n.id === connId);
          if (target) {
            const startX = node.position.x + 110; // centro abajo
            const startY = node.position.y + 60;
            const endX = target.position.x + 110; // centro arriba
            const endY = target.position.y;
            drawArrow(startX, startY, endX, endY);
          }
        });
      });

      // Dibujar nodos encima
      nodes.forEach(drawNode);
    }

    drawFlowchart();
  </script>
</body>
</html>
